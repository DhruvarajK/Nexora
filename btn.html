<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome Animation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        #welcome {
            font-size: 24px;
            color: #333;
            line-height: 1.5;
            white-space: pre-wrap; /* Preserves spaces and newlines for typing effect */
        }
        .streaming-cursor {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: rgb(32, 32, 32);
            border-radius: 12px;
            margin-left: 2px;
            animation: cursor-pulse 1s infinite ease-in-out;
            vertical-align: text-bottom;
        }
        @keyframes cursor-pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.9;
                transform: scale(0.6);
            }
        }
        #restart-btn {
            position: absolute;
            bottom: 20px;
            padding: 10px 20px;
            background: #10a37f;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        #restart-btn:hover {
            background: #0f8b68;
        }
    </style>
</head>
<body>
    <!-- Example of dynamic rendering: This script adds the div after a delay -->
    <script>
        setTimeout(() => {
            const welcomeDiv = document.createElement('div');
            welcomeDiv.id = 'welcome';
            document.body.appendChild(welcomeDiv);
            console.log('Welcome div added dynamically!');
        }, 2000); // Simulates delay in adding the div
    </script>

    <button id="restart-btn">Restart Streaming</button>

    <script>
        // Variable to store user name (replace with actual user input, e.g., from localStorage or API)
        const userName = "Alex"; // Example: Change this to dynamic value like document.getElementById('username').value;

        // Time-based greeting
        const now = new Date();
        const hour = now.getHours();
        let timeGreeting;
        if (hour < 12) {
            timeGreeting = "Good morning";
        } else if (hour < 17) {
            timeGreeting = "Good afternoon";
        } else {
            timeGreeting = "Good evening";
        }

        // Array of random welcome messages
        const welcomeMessages = [
            "What should we dive into today?",
            "Hey, nice to see you. Whatâ€™s new?",
            "How can I help you today?",
            "Ready for some adventure?",
            "What's on your mind?",
            "Let's make today awesome!",
            "Excited to chat with you!"
        ];

        // Select a random message (can be re-randomized on restart if desired)
        let randomMessage = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];

        // Full welcome text
        let fullText = `${timeGreeting}, ${userName}! ${randomMessage}`;

        // Typing animation setup
        let i = 0;
        let currentText;
        let cursor;
        let isInitialized = false;
        let typingComplete = false;

        function initializeAnimation() {
            const welcomeEl = document.getElementById('welcome');
            if (!welcomeEl || isInitialized) return;

            // Create persistent text node and cursor
            currentText = document.createTextNode('');
            cursor = document.createElement('span');
            cursor.className = 'streaming-cursor';
            cursor.style.display = 'inline-block'; // Ensure visible
            welcomeEl.appendChild(currentText);
            welcomeEl.appendChild(cursor);
            isInitialized = true;
        }

        function typeWriter() {
            if (!currentText) return; // Ensure initialized

            if (i < fullText.length) {
                currentText.textContent = fullText.slice(0, i);
                i++;
                setTimeout(typeWriter, 100); // Typing speed: 100ms per character
            } else {
                currentText.textContent = fullText;
                typingComplete = true;
                // Hide cursor after 1 second of completion
                setTimeout(() => {
                    if (cursor && typingComplete) {
                        cursor.style.display = 'none';
                    }
                }, 1000);
            }
        }

        function restartStreaming() {
            if (!isInitialized) return; // Wait for init

            // Reset state
            i = 0;
            typingComplete = false;
            currentText.textContent = '';
            cursor.style.display = 'inline-block'; // Show cursor again

            // Optionally re-randomize message for variety
            randomMessage = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
            fullText = `${timeGreeting}, ${userName}! ${randomMessage}`;

            // Clear any pending timeouts (basic, but effective for this)
            typeWriter(); // Start immediately
        }

        // Wait for the div to be dynamically added and start animation
        function waitForElement() {
            const welcomeEl = document.getElementById('welcome');
            if (welcomeEl) {
                initializeAnimation();
                setTimeout(typeWriter, 500); // Brief pause after init before typing starts
            } else {
                setTimeout(waitForElement, 100); // Poll every 100ms
            }
        }

        // Start waiting on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', waitForElement);
        } else {
            waitForElement();
        }

        // Attach restart function to button click (for demo)
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('new-ch-tog');
            if (btn) {
                btn.addEventListener('click', restartStreaming);
            }
        });
    </script>
</body>
</html>